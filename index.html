<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horas Planet√°rias</title>
  <!-- Inclus√£o da biblioteca SunCalc via CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: linear-gradient(to bottom, #1a1a2e, #0f3460);
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 90%;
      width: 600px;
      margin: auto;
      padding: 20px;
      background: rgba(22, 33, 62, 0.9);
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(255, 255, 255, 0.2);
    }
    h1, h2 {
      color: #f8b400;
      margin-bottom: 10px;
    }
    /* Base para os m√≥dulos */
    .planet-info {
      padding: 15px;
      background: rgba(15, 52, 96, 0.8);
      border-radius: 5px;
      margin-bottom: 5px;
    }
    .day-definition, #lua-data, #kit-content {
      color: #f8b400;
      font-size: 0.8em;
      margin-top: 5px;
    }
    /* Reduzir espa√ßamento entre par√°grafos no Kit Planet√°rio */
    #kit-content p {
      margin: 2px 0;
    }
    .row {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      justify-content: space-between;
      margin: 5px 0;
    }
    #hora-planetaria-container {
      margin-top: 5px;
      margin-bottom: 5px;
    }
    .col {
      flex: 1 1 48%;
      box-sizing: border-box;
    }
    .tempo-restante, .adjacent-hours, #info-message {
      color: #f8b400;
      font-size: 0.8em;
      margin-top: 5px;
    }
    /* M√≥dulo "A Lua Hoje" */
    #lua-info-container {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .lua-details {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 10px;
      width: 100%;
      text-align: left;
    }
    /* Atualiza√ß√£o para contorno circular no √≠cone da Lua */
    #lua-icon {
      font-size: 2em;
      display: inline-block;
      width: 2.5em;
      height: 2.5em;
      line-height: 2.5em;
      border: 1px solid white;
      border-radius: 50%;
    }
    #lua-eclipse {
      margin-top: 5px;
    }
    /* Container para o bot√£o */
    .button-container {
      margin-top: 10px;
    }
    .button {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      background-color: #f8b400;
      color: #1a1a2e;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .button:hover {
      background-color: #ffcc29;
    }
    #location-status {
      display: none;
    }
    #city-name {
      font-weight: bold;
    }
    /* Oculta os m√≥dulos at√© a localiza√ß√£o ser detectada */
    #info-all {
      display: none;
    }
    @media (max-width: 768px) {
      .container {
        width: 95%;
      }
      .col {
        flex: 1 1 100%;
      }
      .lua-details {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Elementos vis√≠veis inicialmente -->
    <h1>Horas Planet√°rias</h1>
    <p>Confira o dia e a hora planet√°ria atual baseado na sua localiza√ß√£o.</p>
    <div class="button-container">
      <button class="button" onclick="getLocation()">Detectar Localiza√ß√£o</button>
    </div>
    
    <!-- Bloco com os demais m√≥dulos, inicialmente oculto -->
    <div id="info-all">
      <!-- M√≥dulo Planeta Regente -->
      <div class="planet-info" id="dia-planetario-container">
        <h2>Planeta Regente: <span id="dia-planetario">...</span></h2>
        <p class="day-definition" id="day-definition">( )</p>
        <p class="tempo-restante" id="tempo-timers">
          <span id="tempo-passado">O Sol nasceu h√°: --:--:--</span> | 
          <span id="tempo-ate-p√¥r">O Sol se p√µe em: --:--:--</span>
        </p>
      </div>
      
      <!-- M√≥dulo Kit Planet√°rio de hoje -->
      <div class="planet-info" id="kit-planetario-container">
        <h2>Kit Planet√°rio de hoje</h2>
        <div id="kit-content">Carregando...</div>
      </div>
      
      <!-- Linha com duas colunas: Informa√ß√µes adicionais e A Lua Hoje -->
      <div class="row">
        <!-- M√≥dulo Informa√ß√µes adicionais -->
        <div class="planet-info col" id="info-container">
          <h2 id="info-title">...</h2>
          <p id="info-message"></p>
        </div>
        <!-- M√≥dulo A Lua Hoje -->
        <div class="planet-info col" id="lua-info-container">
          <h2>A Lua Hoje</h2>
          <div class="lua-details">
            <div id="lua-icon">--</div>
            <div id="lua-data">
              <div id="lua-sign">Signo: --</div>
              <div id="lua-eclipse"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- M√≥dulo Hora Planet√°ria Atual -->
      <div class="planet-info" id="hora-planetaria-container">
        <h2>Hora Planet√°ria Atual: <span id="planet-icon">üîÜ</span> <span id="hora-planetaria"></span></h2>
        <p class="tempo-restante">Tempo Restante: <span id="cronometro">--:--:--</span></p>
        <p class="adjacent-hours">
          Hora Anterior: <span id="hora-anterior">...</span> | Pr√≥xima Hora: <span id="proxima-hora">...</span>
        </p>
      </div>
      
      <!-- Dados extras -->
      <p id="location-status">Localiza√ß√£o n√£o detectada.</p>
      <p id="city-name">Cidade n√£o detectada.</p>
      <p id="sunrise-sunset">
        Nascer do Sol: <span id="sunrise-time">--:--</span> | P√¥r do Sol: <span id="sunset-time">--:--</span>
      </p>
      
      <!-- Container para o bot√£o (ser√° movido para o fim) -->
      <div class="button-container" id="button-bottom">
        <button class="button" onclick="getLocation()">Detectar Localiza√ß√£o</button>
      </div>
    </div>
  </div>
  
  <script>
    // Configura√ß√µes gerais
    const firstHourMapping = [
      "‚òâ H√©lios/Sol",
      "‚òΩ Selene/Lua",
      "‚ôÇ Ares/Marte",
      "‚òø Hermes/Merc√∫rio",
      "‚ôÉ Zeus/J√∫piter",
      "‚ôÄ Afrodite/V√™nus",
      "‚ôÑ Cronos/Saturno"
    ];
    const chaldeanOrder = ["‚ôÑ Saturno", "‚ôÉ J√∫piter", "‚ôÇ Marte", "‚òâ Sol", "‚ôÄ V√™nus", "‚òø Merc√∫rio", "‚òΩ Lua"];
    const dayNames = ["Domingo", "Segunda-feira", "Ter√ßa-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira", "S√°bado"];
    const dayDefinitions = {
      "Domingo": "Dia de vitalidade, brilho pessoal e lideran√ßa. Ideal para rituais de fortalecimento da identidade, sucesso, autoestima e visibilidade.",
      "Segunda-feira": "Ligada √†s emo√ß√µes, intui√ß√£o e mem√≥ria ancestral. Excelente para pr√°ticas de autoconhecimento, cura emocional e conex√£o com o feminino.",
      "Ter√ßa-feira": "Energia de a√ß√£o, coragem e vontade. Favor√°vel para feiti√ßos de prote√ß√£o, supera√ß√£o de obst√°culos e in√≠cio de empreitadas ousadas.",
      "Quarta-feira": "Regida pela mente e pela comunica√ß√£o. Indicado para trabalhos m√°gicos ligados a estudo, escrita, com√©rcio, viagens e eloqu√™ncia.",
      "Quinta-feira": "Vibra√ß√£o de expans√£o, sorte e sabedoria. Potente para rituais de crescimento, justi√ßa, gratid√£o, f√© e prosperidade.",
      "Sexta-feira": "Harmonia, prazer e beleza em destaque. √ìtima para encantamentos voltados ao amor, √† arte, √† autoestima e √† atra√ß√£o.",
      "S√°bado": "Estrutura, disciplina e introspec√ß√£o. Prop√≠cio para banimentos, encerramentos de ciclos, prote√ß√£o e fortalecimento espiritual."
    };
    const dayConfigurations = {
      "Domingo": {
        sequence: ["‚òâ Sol", "‚ôÄ V√™nus", "‚òø Merc√∫rio", "‚òΩ Lua", "‚ôÑ Saturno", "‚ôÉ J√∫piter", "‚ôÇ Marte"],
        messages: [
          "Fazendo um discurso",
          "Ganhando o amor de um senhor",
          "Para se dirigir aos senhores",
          "Para um encontro com um senhor",
          "Pode impedir um encontro com um senhor",
          "Pode comparecer perante um senhor",
          "Fazer nada",
          "Para qualquer coisa sobre senores",
          "Para qualquer coisa sobre amor",
          "Pode escrever uma peti√ß√£o",
          "Pode fazer um discurso",
          "Fazer nada",
          "Pode ajudar os amigos",
          "Para impedir um discurso",
          "Pode enviar sonhos a um rei",
          "Pode enviar sonhos a uma senhora",
          "Fazer nada",
          "Trabalhar",
          "Fazer nada",
          "Magia ou talism√£s para o amor dos senores",
          "Para amarrar e restringir outros",
          "Pode comparecer perante um rei",
          "Pode aparecer diante de uma senhora",
          "Descanse, n√£o fa√ßa nada"
        ]
      },
      "S√°bado": {
        sequence: ["‚ôÑ Saturno", "‚ôÉ J√∫piter", "‚ôÇ Marte", "‚òâ Sol", "‚ôÄ V√™nus", "‚òø Merc√∫rio", "‚òΩ Lua"],
        messages: [
          "Magia ou talism√£s para ferir seu inimigo ou enviar doen√ßas",
          "Pode causar um naufr√°gio ou prejudicar algu√©m",
          "Para configurar encantamentos",
          "Pode fazer os senhores lutarem entre si",
          "Pode causar √≥dio entre um casal",
          "Pode encontrar o tesouro",
          "Pode falar com dem√¥nios",
          "Para realizar a adivinha√ß√£o da bacia",
          "Para realizar a adivinha√ß√£o do cr√¢nio",
          "Pode fazer com que os povos mergulhem no mar",
          "Pode deixar os litigantes furiosos uns com os outros",
          "Pode causar medo e inimizade",
          "Ben√©fico para descobrir segredos",
          "Pode ver pessoas mortas",
          "Para ter vis√µes ‚Äì Para adivinha√ß√£o de √°gua",
          "√ötil para ensinar",
          "Hora muito maligna",
          "Hora in√∫til",
          "Para ganhar dinheiro em dados",
          "Pode conter todas as coisas boas",
          "Hora sem virtude",
          "Pode causar vis√µes",
          "√ötil para lucro",
          "Hora de aborrecimento e inimizade"
        ]
      }
    };

    // Calend√°rio Lunar de 2025
    const lunarCalendar = [
      { date: "2025-03-06", info: "Lua Crescente em G√™meos, 6 de mar√ßo, √†s 13h31 (hor√°rio de Bras√≠lia)" },
      { date: "2025-03-14", info: "Lua Cheia em Virgem ‚Äì Eclipse Lunar, 14 de mar√ßo, √†s 3h54" },
      { date: "2025-03-22", info: "Lua Minguante em Capric√≥rnio, 22 de mar√ßo, √†s 8h29" },
      { date: "2025-03-29", info: "Lua Nova em √Åries ‚Äì Eclipse Solar, 29 de mar√ßo, √†s 7h57" },
      { date: "2025-04-04", info: "Lua Crescente em C√¢ncer, 4 de abril, √†s 23h14 (hor√°rio de Bras√≠lia)" },
      { date: "2025-04-12", info: "Lua Cheia em Libra, 12 de abril, √†s 21h22" },
      { date: "2025-04-20", info: "Lua Minguante em Aqu√°rio, 20 de abril, √†s 22h35" },
      { date: "2025-04-27", info: "Lua Nova em Touro, 27 de abril, √†s 16h31" },
      { date: "2025-05-04", info: "Lua Crescente em Le√£o, 4 de maio, √†s 10h51 (hor√°rio de Bras√≠lia)" },
      { date: "2025-05-12", info: "Lua Cheia em Escorpi√£o, 12 de maio, √†s 13h55" },
      { date: "2025-05-20", info: "Lua Minguante em Aqu√°rio, 20 de maio, √†s 8h58" },
      { date: "2025-05-27", info: "Lua Nova em G√™meos, 27 de maio, √† 0h02" },
      { date: "2025-06-03", info: "Lua Crescente em Virgem, 3 de junho, √† 0h40 (hor√°rio de Bras√≠lia)" },
      { date: "2025-06-11", info: "Lua Cheia em Sagit√°rio, 11 de junho, √†s 4h43" },
      { date: "2025-06-18", info: "Lua Minguante em Peixes, 18 de junho, √†s 16h19" },
      { date: "2025-06-25", info: "Lua Nova em C√¢ncer, 25 de junho, √†s 7h31" },
      { date: "2025-07-02", info: "Lua Crescente em Libra, 2 de julho, √†s 16h30 (hor√°rio de Bras√≠lia)" },
      { date: "2025-07-10", info: "Lua Cheia em Capric√≥rnio, 10 de julho, √†s 17h36" },
      { date: "2025-07-17", info: "Lua Minguante em √Åries, 17 de julho, √†s 21h37" },
      { date: "2025-07-24", info: "Lua Nova em Le√£o, 24 de julho, √†s 16h11" },
      { date: "2025-08-01", info: "Lua Crescente em Escorpi√£o, 1¬∫ de agosto, √†s 9h41 (hor√°rio de Bras√≠lia)" },
      { date: "2025-08-09", info: "Lua Cheia em Aqu√°rio, 9 de agosto, √†s 4h55" },
      { date: "2025-08-16", info: "Lua Minguante em Touro, 16 de agosto, √†s 2h12" },
      { date: "2025-08-23", info: "Lua Nova em Virgem, 23 de agosto, √†s 3h06" },
      { date: "2025-08-31", info: "Lua Crescente em Sagit√°rio, 31 de agosto, √†s 3h25" },
      { date: "2025-09-07", info: "Lua Cheia em Peixes ‚Äì Eclipse Lunar, 7 de setembro, √†s 15h08" },
      { date: "2025-09-14", info: "Lua Minguante em G√™meos, 14 de setembro, √†s 7h32" },
      { date: "2025-09-21", info: "Lua Nova em Virgem ‚Äì Eclipse Solar, 21 de setembro, √†s 16h54" },
      { date: "2025-09-29", info: "Lua Crescente em Capric√≥rnio, 29 de setembro, √†s 20h53" },
      { date: "2025-10-07", info: "Lua Cheia em √Åries, 7 de outubro, √† 0h47" },
      { date: "2025-10-13", info: "Lua Minguante em C√¢ncer, 13 de outubro, √†s 15h12" },
      { date: "2025-10-21", info: "Lua Nova em Libra, 21 de outubro, √†s 9h25" },
      { date: "2025-10-29", info: "Lua Crescente em Aqu√°rio, 29 de outubro, √†s 13h20" },
      { date: "2025-11-05", info: "Lua Cheia em Touro, 5 de novembro, √†s 10h19" },
      { date: "2025-11-12", info: "Lua Minguante em Le√£o, 12 de novembro, √†s 2h28" },
      { date: "2025-11-20", info: "Lua Nova em Escorpi√£o, 20 de novembro, √†s 3h47" },
      { date: "2025-11-28", info: "Lua Crescente em Peixes, 28 de novembro, √†s 3h58" },
      { date: "2025-12-04", info: "Lua Cheia em G√™meos, 4 de dezembro, √†s 20h14" },
      { date: "2025-12-11", info: "Lua Minguante em Virgem, 11 de dezembro, √†s 17h51" },
      { date: "2025-12-19", info: "Lua Nova em Sagit√°rio, 19 de dezembro, √†s 22h43" },
      { date: "2025-12-27", info: "Lua Crescente em √Åries, 27 de dezembro, √†s 16h09" }
    ];

    function formatEclipseDate(dateStr) {
      const dateObj = new Date(dateStr);
      const day = dateObj.getUTCDate();
      const monthNames = ["janeiro", "fevereiro", "mar√ßo", "abril", "maio", "junho", "julho", "agosto", "setembro", "outubro", "novembro", "dezembro"];
      const month = monthNames[dateObj.getUTCMonth()];
      const year = dateObj.getUTCFullYear();
      return `${day} de ${month} de ${year}`;
    }

    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
      } else {
        document.getElementById("location-status").innerText = "Geolocaliza√ß√£o n√£o suportada pelo navegador.";
      }
    }

    function showPosition(position) {
      document.getElementById("location-status").innerText = "Localiza√ß√£o detectada.";
      let lat = position.coords.latitude;
      let lon = position.coords.longitude;
      getSunTimes(lat, lon);
      getCityName(lat, lon);
      updateMoonInfo(lat, lon);
      // Exibe os demais m√≥dulos
      document.getElementById("info-all").style.display = "block";
      // Move o bot√£o para o final dos m√≥dulos
      document.getElementById("info-all").appendChild(document.getElementById("button-bottom"));
    }

    function getCityName(lat, lon) {
      let url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
      fetch(url)
        .then(response => response.json())
        .then(data => {
          let city = data.address.city || data.address.town || data.address.village || "Cidade desconhecida";
          let state = data.address.state || "Estado desconhecido";
          document.getElementById("city-name").innerText = `Cidade: ${city}, ${state}`;
        })
        .catch(error => {
          console.error("Erro ao obter o nome da cidade:", error);
          document.getElementById("city-name").innerText = "Erro ao obter a cidade.";
        });
    }

    function showError(error) {
      document.getElementById("location-status").innerText = "Erro ao obter localiza√ß√£o.";
    }

    function getSunTimes(lat, lon) {
      let url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=sunrise,sunset&timezone=auto`;
      fetch(url)
        .then(response => response.json())
        .then(data => {
          let sunrise = new Date(data.daily.sunrise[0]);
          let sunset = new Date(data.daily.sunset[0]);
          let nextSunrise = new Date(sunrise.getTime() + 24 * 60 * 60 * 1000);
          let sunriseFormatted = sunrise.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
          let sunsetFormatted = sunset.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
          document.getElementById("sunrise-time").innerText = sunriseFormatted;
          document.getElementById("sunset-time").innerText = sunsetFormatted;
          window.sunrise = sunrise;
          window.sunset = sunset;
          window.nextSunrise = nextSunrise;
          calculatePlanetaryHours(sunrise, sunset, nextSunrise);
          startElapsedTimeTimer(sunrise, sunset);
          startTimeUntilSunset(sunset, nextSunrise);
        })
        .catch(error => {
          console.error("Erro ao obter hor√°rios do sol:", error);
          document.getElementById("sunrise-time").innerText = "Erro";
          document.getElementById("sunset-time").innerText = "Erro";
        });
    }

    function calculatePlanetaryHours(sunrise, sunset, nextSunrise) {
      let today = new Date();
      let currentTime = today;
      let startDayIndex;
      if (currentTime < sunrise) {
        let prevSunrise = new Date(sunrise.getTime() - 24 * 60 * 60 * 1000);
        let prevSunset = new Date(sunset.getTime() - 24 * 60 * 60 * 1000);
        nextSunrise = sunrise;
        sunrise = prevSunrise;
        sunset = prevSunset;
        startDayIndex = (today.getDay() + 6) % 7;
      } else {
        startDayIndex = today.getDay();
      }
      document.getElementById("dia-planetario").innerText = firstHourMapping[startDayIndex];
      document.getElementById("day-definition").innerText = dayDefinitions[dayNames[startDayIndex]];
      let config = dayConfigurations[dayNames[startDayIndex]];
      let planetaryHours = [];
      if (config && config.sequence) {
        for (let i = 0; i < 24; i++) {
          planetaryHours.push(config.sequence[i % config.sequence.length]);
        }
      } else {
        let firstHourPlanet = firstHourMapping[startDayIndex];
        let icon = firstHourPlanet.charAt(0);
        let firstHourIndex = chaldeanOrder.findIndex(el => el.startsWith(icon));
        for (let i = 0; i < 24; i++) {
          planetaryHours.push(chaldeanOrder[(firstHourIndex + i) % 7]);
        }
      }
      let dayDuration = (sunset - sunrise) / 12;
      let nightDuration = (nextSunrise - sunset) / 12;
      let intervalStart, intervalEnd;
      let currentHourIndex;
      if (currentTime >= sunrise && currentTime < sunset) {
        let h = Math.floor((currentTime - sunrise) / dayDuration);
        currentHourIndex = h + 1;
        intervalStart = new Date(sunrise.getTime() + h * dayDuration);
        intervalEnd = new Date(intervalStart.getTime() + dayDuration);
      } else if (currentTime >= sunset && currentTime < nextSunrise) {
        let h = Math.floor((currentTime - sunset) / nightDuration);
        currentHourIndex = 12 + h + 1;
        intervalStart = new Date(sunset.getTime() + h * nightDuration);
        intervalEnd = new Date(intervalStart.getTime() + nightDuration);
      } else if (currentTime < sunrise) {
        currentHourIndex = 24;
        intervalEnd = sunrise;
        intervalStart = new Date(sunrise.getTime() - nightDuration);
      } else {
        currentHourIndex = 1;
        intervalStart = nextSunrise;
        intervalEnd = new Date(nextSunrise.getTime() + dayDuration);
      }
      let currentPlanet = planetaryHours[currentHourIndex - 1];
      document.getElementById("planet-icon").innerText = currentPlanet;
      let previousPlanet = planetaryHours[(currentHourIndex - 2 + 24) % 24];
      document.getElementById("hora-anterior").innerText = previousPlanet;
      let nextPlanet = planetaryHours[(currentHourIndex) % 24];
      document.getElementById("proxima-hora").innerText = nextPlanet;
      startCronometro(intervalEnd);
      let dayTitle = dayNames[startDayIndex];
      let ordinal = currentHourIndex + "¬™";
      document.getElementById("info-title").innerText = dayTitle + " - " + ordinal + " Hora";
      if (config && config.messages) {
        document.getElementById("info-message").innerText = config.messages[currentHourIndex - 1];
      } else {
        document.getElementById("info-message").innerText = "";
      }
      
      // Atualiza o m√≥dulo Kit Planet√°rio de hoje ap√≥s definir o planeta regente
      updateKitPlanetario();
    }

    function startCronometro(endTime) {
      if (window.cronometroInterval) clearInterval(window.cronometroInterval);
      window.cronometroInterval = setInterval(() => {
        const now = new Date();
        const diff = endTime - now;
        if (diff <= 0) {
          document.getElementById("cronometro").innerText = "00:00:00";
          clearInterval(window.cronometroInterval);
          calculatePlanetaryHours(window.sunrise, window.sunset, window.nextSunrise);
        } else {
          const totalSeconds = Math.floor(diff / 1000);
          const hours = Math.floor(totalSeconds / 3600);
          const minutes = Math.floor((totalSeconds % 3600) / 60);
          const seconds = totalSeconds % 60;
          const formatted =
            (hours < 10 ? "0" + hours : hours) + ":" +
            (minutes < 10 ? "0" + minutes : minutes) + ":" +
            (seconds < 10 ? "0" + seconds : seconds);
          document.getElementById("cronometro").innerText = formatted;
        }
      }, 1000);
    }

    function startElapsedTimeTimer(sunrise, sunset) {
      if (window.elapsedTimeInterval) clearInterval(window.elapsedTimeInterval);
      window.elapsedTimeInterval = setInterval(() => {
        let now = new Date();
        let diff, label;
        if (now < sunset) {
          diff = now - sunrise;
          label = "O Sol nasceu h√°: ";
        } else {
          diff = now - sunset;
          label = "O Sol se p√¥s h√°: ";
        }
        if (diff < 0) diff = 0;
        const totalSeconds = Math.floor(diff / 1000);
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        const formatted =
          (hours < 10 ? "0" + hours : hours) + ":" +
          (minutes < 10 ? "0" + minutes : minutes) + ":" +
          (seconds < 10 ? "0" + seconds : seconds);
        document.getElementById("tempo-passado").innerText = label + formatted;
      }, 1000);
    }

    function startTimeUntilSunset(sunset, nextSunrise) {
      if (window.sunsetInterval) clearInterval(window.sunsetInterval);
      window.sunsetInterval = setInterval(() => {
        let now = new Date();
        let diff, label;
        if (now < sunset) {
          diff = sunset - now;
          label = "O Sol se p√µe em: ";
        } else {
          diff = nextSunrise - now;
          label = "O Sol nascer√° em: ";
        }
        if (diff < 0) diff = 0;
        const totalSeconds = Math.floor(diff / 1000);
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        const formatted =
          (hours < 10 ? "0" + hours : hours) + ":" +
          (minutes < 10 ? "0" + minutes : minutes) + ":" +
          (seconds < 10 ? "0" + seconds : seconds);
        document.getElementById("tempo-ate-p√¥r").innerText = label + formatted;
      }, 1000);
    }

    // Atualiza informa√ß√µes lunares usando SunCalc.
    // "lua-icon": exibe o √≠cone da fase.
    // "lua-sign": se hoje for o dia do evento, exibe o evento completo (fase, signo, data e hora);
    // caso contr√°rio, exibe "fase em signo".
    function updateMoonInfo(lat, lon) {
      const moonIllum = SunCalc.getMoonIllumination(new Date());
      const phase = moonIllum.phase;
      let phaseName = "";
      let phaseIcon = "";
      if (phase < 0.0625 || phase >= 0.9375) {
        phaseName = "Lua Nova";
        phaseIcon = "üåë";
      } else if (phase < 0.1875) {
        phaseName = "Crescente";
        phaseIcon = "üåí";
      } else if (phase < 0.3125) {
        phaseName = "Quarto Crescente";
        phaseIcon = "üåì";
      } else if (phase < 0.4375) {
        phaseName = "Gibosa Crescente";
        phaseIcon = "üåî";
      } else if (phase < 0.5625) {
        phaseName = "Lua Cheia";
        phaseIcon = "üåï";
      } else if (phase < 0.6875) {
        phaseName = "Gibosa Minguante";
        phaseIcon = "üåñ";
      } else if (phase < 0.8125) {
        phaseName = "Quarto Minguante";
        phaseIcon = "üåó";
      } else {
        phaseName = "Minguante";
        phaseIcon = "üåò";
      }
      document.getElementById("lua-icon").innerText = phaseIcon;
      
      const todayStr = new Date().toISOString().split("T")[0];
      let currentEvent = null;
      for (const event of lunarCalendar) {
        if (event.date <= todayStr) {
          currentEvent = event;
        }
      }
      if (currentEvent) {
        let signName = extractSign(currentEvent.info);
        if (todayStr === currentEvent.date) {
          // Se for o dia exato do evento, exibe o evento completo
          let dashIndex = currentEvent.info.indexOf("‚Äì");
          if (dashIndex !== -1) {
            let eclipseInfo = currentEvent.info.substring(dashIndex + 1).trim();
            document.getElementById("lua-sign").innerText = currentEvent.info.split("‚Äì")[0].trim();
            document.getElementById("lua-eclipse").innerHTML = "<strong>" + eclipseInfo + "</strong>";
          } else {
            document.getElementById("lua-sign").innerText = currentEvent.info;
            document.getElementById("lua-eclipse").innerText = "";
          }
        } else {
          document.getElementById("lua-sign").innerText = phaseName + " em " + signName;
          document.getElementById("lua-eclipse").innerText = "";
        }
      } else {
        document.getElementById("lua-sign").innerText = phaseName + " em --";
        document.getElementById("lua-eclipse").innerText = "";
      }
    }

    // Fun√ß√£o auxiliar para extrair o nome do signo a partir do texto do evento
    function extractSign(info) {
      let lowerInfo = info.toLowerCase();
      let index = lowerInfo.indexOf(" em ");
      if (index !== -1) {
        let after = info.substring(index + 4).trim();
        let commaIndex = after.indexOf(",");
        let hyphenIndex = after.indexOf("‚Äì");
        let endIndex = after.length;
        if (commaIndex !== -1 && hyphenIndex !== -1) {
          endIndex = Math.min(commaIndex, hyphenIndex);
        } else if (commaIndex !== -1) {
          endIndex = commaIndex;
        } else if (hyphenIndex !== -1) {
          endIndex = hyphenIndex;
        }
        return after.substring(0, endIndex).trim();
      }
      return "";
    }

    // Atualiza o m√≥dulo "Kit Planet√°rio de hoje" com base no planeta regente
    function updateKitPlanetario() {
      let regenteText = document.getElementById("dia-planetario").innerText;
      let parts = regenteText.split("/");
      let planetName = parts.length > 1 ? parts[1].trim() : regenteText.trim();
      let kit = kitDetails[planetName];
      let kitContent = "";
      if (kit) {
        kitContent += "<p><strong>Vela:</strong> " + kit.vela + "</p>";
        kitContent += "<p><strong>Incenso:</strong> " + kit.incenso + "</p>";
        kitContent += "<p><strong>Pedras:</strong> " + kit.pedras + "</p>";
        if (kit.alternativas) {
          kitContent += "<p><strong>Alternativas:</strong> " + kit.alternativas + "</p>";
        }
        kitContent += "<p><strong>Usos:</strong> " + kit.usos + "</p>";
      } else {
        kitContent = "<p>Sem kit definido para " + planetName + ".</p>";
      }
      document.getElementById("kit-content").innerHTML = kitContent;
    }

    // Detalhes dos kits para cada planeta
    const kitDetails = {
      "Sol": {
        vela: "Dourada, Amarela, Laranja",
        incenso: "Ol√≠bano (Frankincense), Alecrim, Canela, Girassol",
        pedras: "Olho de Tigre, Citrino, Top√°zio Imperial, √Çmbar, Granada",
        usos: "Vitalidade, poder pessoal, sucesso, cura, lideran√ßa"
      },
      "Lua": {
        vela: "Branca, Prata, Azul Claro",
        incenso: "Jasmim, S√¢ndalo Branco, Camomila, Mirra",
        pedras: "Pedra da Lua, Selenita, P√©rola, Opala Branca, Quartzo Leitoso",
        usos: "Intui√ß√£o, emo√ß√µes, sonhos, prote√ß√£o ps√≠quica, fertilidade"
      },
      "Marte": {
        vela: "Vermelha, Escarlate",
        incenso: "Cravo, Gengibre, Pimenta-Do-Reino, Arruda",
        pedras: "Jaspe Vermelho, Granada",
        alternativas: "Rubi, Coral Vermelho, Hematita",
        usos: "A√ß√£o, coragem, prote√ß√£o, energia, combate espiritual"
      },
      "Merc√∫rio": {
        vela: "Amarela, Laranja, Cinza",
        incenso: "Lavanda, Hortel√£, Erva-Doce, Anis",
        pedras: "√Ågata, Fluorita, Citrino, Turquesa",
        usos: "Comunica√ß√£o, racioc√≠nio, aprendizado, escrita, com√©rcio"
      },
      "J√∫piter": {
        vela: "Azul Royal, Roxa, Verde",
        incenso: "Benjoim, Noz-Moscada, Cedro, S√°lvia",
        pedras: "Ametista, L√°pis-Laz√∫li, Safira, Sodalita, Olho de Falc√£o",
        usos: "Expans√£o, prosperidade, sorte, sabedoria espiritual"
      },
      "V√™nus": {
        vela: "Rosa, Verde, Cobre",
        incenso: "Rosa, Patchouli, S√¢ndalo Rosa, Baunilha",
        pedras: "Quartzo Rosa, Esmeralda, Jade, Malaquita, Rodocrosita",
        usos: "Amor, beleza, prazer, harmonia, arte, magnetismo pessoal"
      },
      "Saturno": {
        vela: "Preta, Cinza, Azul Escuro",
        incenso: "Mirra, Cipreste, Vetiver, Pinho",
        pedras: "√înix, Obsidiana, Turmalina Preta, Hematita, Safira Negra",
        usos: "Estrutura, prote√ß√£o, banimento, introspec√ß√£o, disciplina"
      }
    };
  </script>
</body>
</html>
